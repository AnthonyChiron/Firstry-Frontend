<card title="Résultats">
  <div header *ngIf="currentStep" class="flexRow alignCenter gap10">
    <div class="flexRow alignEnd gap10">
      <h3 *ngIf="currentStep.state == 'RESULT_PENDING'">Non publié</h3>
      <h3 *ngIf="currentStep.state == 'RESULT_PUBLISHED'">Publié</h3>
    </div>
    <btn
      *ngIf="currentStep.state == 'RESULT_PENDING'"
      type="valid"
      label="Publier"
      (click)="publishResult()"
    ></btn>
    <btn
      *ngIf="currentStep.state == 'RESULT_PUBLISHED'"
      type="danger"
      label="Dépublier"
      (click)="unpublishResult()"
    ></btn>
    <dropdown
      class="contestDropDown"
      [options]="stepsOptions"
      (selected)="selectStep($event.value)"
      [value]="currentStep"
    ></dropdown>
  </div>
  <div *ngIf="currentStep" class="flexCardColumn">
    <div class="flexCardRow">
      <div class="flex3 flexColumn gap10">
        <div class="pool" *ngFor="let pool of pools; index as i">
          <card
            color="2"
            size="m"
            class="riders"
            [title]="'Poule ' + (i + 1)"
            [btn]="!edit"
            (btnClicked)="editPool(i)"
          >
            <div class="flexColumn gap10">
              <div class="header">
                <p>Riders</p>
                <p>Points</p>
                <!-- <p *ngIf="edit && editPoolIndex == i">Options</p> -->
              </div>
              <div
                class="rider flexRow alignCenter spaceBetween"
                *ngFor="let rider of pool"
              >
                <div class="flexRow gap10 flex4">
                  <p class="firstName">
                    {{ rider.registration.rider.firstName }}
                  </p>
                  <p class="lastName">
                    {{ rider.registration.rider.lastName }}
                  </p>
                </div>
                <input
                  *ngIf="edit && editPoolIndex == i"
                  [(ngModel)]="rider.score"
                  placeholder="Points"
                  type="number"
                  class="flex1"
                />
                <p *ngIf="!edit">{{ rider.score }}</p>
                <!-- <div *ngIf="edit && editPoolIndex == i">
                  <btn type="warning" label="Abandon"></btn>
                </div> -->
              </div>
              <div
                class="flexRow spaceBetween"
                *ngIf="edit && editPoolIndex == i"
              >
                <btn type="danger" label="Annuler" (click)="edit = !edit"></btn>
                <btn
                  type="valid"
                  label="Confirmer"
                  (click)="validResult()"
                ></btn>
              </div>
            </div>
          </card>
        </div>
      </div>
      <card class="flex2" color="2" size="m" title="Aperçu du classement">
        <app-table
          [headers]="['#', 'Nom & prénom', 'Score']"
          [columns]="['rank', 'name', 'score']"
          [data]="table"
          sortColumn="rank"
        ></app-table>
      </card>
    </div>
  </div>
  <div *ngIf="!currentStep" class="flexColumn alignCenter gap10">
    <p>Les poules de cette catégorie n'ont pas encore été créées.</p>
    <btn
      label="Créer les poules"
      [routerLink]="['/dashboard', contest._id, 'pools']"
    ></btn>
  </div>
</card>
