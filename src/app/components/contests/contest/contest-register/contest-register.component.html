<div
  *ngIf="contest && !isPaymentFailed && !isPaymentSucceeded"
  [class]="isMobile ? 'flexCardColumn' : 'flexCardRow'"
>
  <card class="flex1 categories" title="Catégories" [fitContent]="true"
    ><div class="flexCardColumn">
      <p *ngIf="contest.categories.length == 0">
        Ce contest n'a pas encore de catégories !
      </p>
      <card
        *ngFor="let category of contest.categories"
        (click)="selectedCategory = category"
        [class.active]="selectedCategory == category"
        class="category"
        color="{{ selectedCategory == category ? 'black' : '2' }}"
        size="s"
        ><div class="flexRow alignCenter spaceBetween">
          <div class="titleCategory">
            <h3>{{ category.name }}</h3>
            <p>-</p>
            <p>{{ category.sports }}</p>
          </div>
          <div class="tags">
            <info-tag
              size="l"
              icon="fa-solid fa-euro-sign"
              label="{{ category.registerPrice }}"
            ></info-tag>
            <info-tag
              size="l"
              icon="fa-solid fa-user"
              label="0 / {{ category.maxRiders }}"
            ></info-tag>
          </div></div
      ></card>
    </div>
  </card>
  <i
    *ngIf="selectedCategory"
    class="fa-solid fa-chevron-{{ isMobile ? 'down' : 'right' }} fa-2xl"
  ></i>
  <card
    *ngIf="isLoggedin && !isPaymentStep && selectedCategory"
    class="flex1 registerCard"
    [title]="'Inscription - ' + selectedCategory.name"
    [fitContent]="true"
  >
    <div class="flexColumn content">
      <div class="description">
        <label>Description</label>
        <p>
          {{
            selectedCategory.description
              ? selectedCategory.description
              : "Aucune description"
          }}
        </p>
      </div>
      <div class="flexCardRow spaceAround">
        <card
          *ngFor="let step of selectedCategory.steps"
          class="flex1"
          color="2"
          size="s"
          ><div class="stepCard">
            <div class="stepTitle spaceBetween">
              <h3>{{ step.name }}</h3>
              <p class="italic">
                {{ step.startDate | date : "dd/MM/yyyy - hh:mm" }}
              </p>
            </div>
            <div class="stepContent">
              <div class="flexColumn spaceAround alignCenter flex1">
                <info-tag
                  size="l"
                  icon="fa-solid fa-user"
                  label="Poules de {{ step.ridersPerPool }}"
                ></info-tag>
                <info-tag
                  *ngIf="step.ridersQualifiedCount > 0"
                  size="l"
                  icon="fa-solid fa-check"
                  label="Qualifié.es {{ step.ridersPerPool }}"
                ></info-tag>
              </div>
              <div class="sep"></div>
              <div class="format flex1">
                <h4 class="textCenter">Format</h4>
                <div
                  *ngFor="let stepFormat of step.rules.stepFormats"
                  class="stepFormat"
                >
                  <info-tag size="l" [label]="getRunLabel(stepFormat)">
                  </info-tag>
                  <div class="sep"></div>
                </div>
              </div>
            </div>
          </div>
        </card>
      </div>
      <div class="footer">
        <div class="price">
          <h4><b>Prix de l'inscription</b></h4>
          <h4>
            <b>{{ selectedCategory.registerPrice }} €</b>
          </h4>
        </div>
        <btn
          label="Passer au paiement"
          type="primary"
          (click)="register()"
        ></btn>
      </div>
    </div>
  </card>
  <card *ngIf="!isLoggedin" class="flex1 connectCard" [fitContent]="true"
    ><h2 class="textCenter">Veuillez vous connecter pour vous inscrire</h2>
    <div class="flexRow spaceAround buttons">
      <btn label="Je me connecte" (click)="isLoginModalOpen = true"></btn>
      <btn label="Je créer un compte" (click)="isLoginModalOpen = true"></btn>
    </div>
  </card>
  <card title="Paiement" class="flex1" *ngIf="isLoggedin && isPaymentStep">
    <paiement
      [amount]="selectedCategory.registerPrice"
      (paymentSucceeded)="paymentSucceeded()"
      (paymentFailed)="paymentFailed()"
    ></paiement>
  </card>
</div>
<card class="success" *ngIf="!isPaymentStep && isPaymentSucceeded && contest">
  <div class="flexColumn alignCenter gap10">
    <h2>
      Merci pour votre inscription au contest {{ contest.name }} !
      <i class="fa-solid fa-check"></i>
    </h2>
    <p>
      Rendez-vous le {{ contest.startDate | date : "dd/MM" }} à
      {{ selectedCategory.steps[0].startDate | date : "hh" }}h !
    </p>
    <p>Vous pouvez retrouver toutes vos inscriptions dans votre compte.</p>
    <div class="flexRow gap10">
      <btn label="Mon compte" type="secondary" routerLink="/account"></btn>
      <btn label="Retour à l'accueil" routerLink=""></btn>
    </div>
  </div>
</card>
<modal
  *ngIf="isLoginModalOpen && !isMobile"
  [isVisible]="isLoginModalOpen"
  (cancelled)="isLoginModalOpen = false"
  ><app-login
    [openTab]="0"
    (modalClosed)="isLoginModalOpen = !isLoginModalOpen"
  ></app-login
></modal>
